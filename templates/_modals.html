<div id="error-toast" class="error-toast"></div>

<div id="add-account-modal" class="modal">
    <div class="modal-content">
        <span class="modal-close-btn">&times;</span>
        <h2>Add New Account</h2>
        <div class="modal-form">
            <input type="text" id="new-account-name-modal" placeholder="Account name" required>
            <select id="new-account-type-modal" class="settings-input">
                <option value="checking">Checking</option>
                <option value="savings">Savings</option>
                <option value="credit_card">Credit Card</option>
                <option value="cash">Cash</option>
                <option value="investment">Investment</option>
            </select>
            <input type="number" id="new-account-balance-modal" placeholder="Initial Balance" value="0.00" step="0.01" required>
            <button id="add-account-btn-modal" class="button-primary">Add Account</button>
        </div>
    </div>
</div>
<div id="edit-account-modal" class="modal">
    <div class="modal-content">
        <span class="modal-close-btn">&times;</span>
        <h2>Edit Account</h2>
        <div class="modal-form">
            <input type="hidden" id="edit-account-id-modal">
            <input type="text" id="edit-account-name-modal" placeholder="New account name" required>
            <select id="edit-account-type-modal" class="settings-input">
                <option value="checking">Checking</option>
                <option value="savings">Savings</option>
                <option value="credit_card">Credit Card</option>
                <option value="cash">Cash</option>
                <option value="investment">Investment</option>
            </select>
            <button id="save-account-changes-btn" class="button-primary">Save Changes</button>
        </div>
    </div>
</div>
<div id="add-transaction-modal" class="modal">
    <div class="modal-content">
        <span class="modal-close-btn">&times;</span>
        <h2>Add New Transaction</h2>
        <div class="modal-form">
            <input type="hidden" id="add-transaction-account-id-modal">
            <div class="radio-group">
                <input type="radio" id="type-expense-add" name="transaction-type-add" value="expense" checked>
                <label for="type-expense-add">Expense</label>
                <input type="radio" id="type-income-add" name="transaction-type-add" value="income">
                <label for="type-income-add">Income</label>
            </div>
            <input type="text" id="new-transaction-description-modal" placeholder="Description" required>
            <input type="number" id="new-transaction-amount-modal" placeholder="Amount" step="0.01" min="0" required>
            <select id="new-transaction-category-select" class="settings-input"></select>
            <button id="add-transaction-btn-modal" class="button-primary">Add Transaction</button>
        </div>
    </div>
</div>
<div id="edit-transaction-modal" class="modal">
    <div class="modal-content">
        <span class="modal-close-btn">&times;</span>
        <h2>Edit Transaction</h2>
        <div class="modal-form">
            <input type="hidden" id="edit-transaction-id-modal">
             <div class="radio-group">
                <input type="radio" id="type-expense-edit" name="transaction-type-edit" value="expense">
                <label for="type-expense-edit">Expense</label>
                <input type="radio" id="type-income-edit" name="transaction-type-edit" value="income">
                <label for="type-income-edit">Income</label>
            </div>
            <input type="text" id="edit-transaction-description-modal" placeholder="Description" required>
            <input type="number" id="edit-transaction-amount-modal" placeholder="Amount" step="0.01" min="0" required>
            <select id="edit-transaction-category-select" class="settings-input"></select>
            <button id="save-transaction-changes-btn" class="button-primary">Save Changes</button>
        </div>
    </div>
</div>

<div id="manage-categories-modal" class="modal">
    <div class="modal-content">
        <span class="modal-close-btn">&times;</span>
        <h2>Manage Categories</h2>
        <div class="category-tabs">
            <button class="category-tab-btn active" data-tab="expense">Expenses</button>
            <button class="category-tab-btn" data-tab="income">Income</button>
        </div>

        <div id="expense-tab-content" class="category-tab-content active">
            <div class="empty-list-message">
                <span class="material-icons-outlined">category</span>
                <p>No expense categories yet.</p>
            </div>
            <ul id="expense-categories-list" class="category-list"></ul>
            <div class="add-category-form">
                <input type="text" class="new-category-name" placeholder="Add new expense category...">
                <button class="add-category-btn button-primary" data-type="expense">Add</button>
            </div>
        </div>

        <div id="income-tab-content" class="category-tab-content">
            <div class="empty-list-message">
                <span class="material-icons-outlined">paid</span>
                <p>No income categories yet.</p>
            </div>
            <ul id="income-categories-list" class="category-list"></ul>
             <div class="add-category-form">
                <input type="text" class="new-category-name" placeholder="Add new income category...">
                <button class="add-category-btn button-primary" data-type="income">Add</button>
            </div>
        </div>
    </div>
</div>

<div id="manage-recurring-modal" class="modal">
    <div class="modal-content wide recurring-modal">
        <span class="modal-close-btn">&times;</span>
        <h2>Recurring Transactions</h2>
        
        <!-- Mobile view tabs -->
        <div class="recurring-view-tabs">
            <button class="recurring-view-tab active" data-view="list">
                <span class="material-icons-outlined">list</span>
                Active Items
            </button>
            <button class="recurring-view-tab" data-view="form">
                <span class="material-icons-outlined">add_circle_outline</span>
                Add / Edit
            </button>
        </div>

        <div class="recurring-container">
            <div class="recurring-list-section" data-view-panel="list">
                <h3 class="recurring-section-title">Active Recurring Items</h3>
                <ul id="recurring-transactions-list" class="recurring-list">
                </ul>
                <div class="empty-list-message" id="recurring-empty-message">
                    <span class="material-icons-outlined">event_repeat</span>
                    <p>No recurring transactions found.</p>
                </div>
            </div>
            <div class="recurring-form-section" data-view-panel="form">
                <h3 id="recurring-form-title" class="recurring-section-title">Add New Recurring Transaction</h3>
                <div class="modal-form">
                    <input type="hidden" id="recurring-transaction-id">
                    
                    <!-- Type Selector -->
                    <div class="recurring-type-tabs">
                        <button class="recurring-type-tab active" data-payment-type="standard">
                            <span class="material-icons-outlined">event_repeat</span>
                            Standard
                        </button>
                        <button class="recurring-type-tab" data-payment-type="debt">
                            <span class="material-icons-outlined">credit_card</span>
                            Debt Payment
                        </button>
                    </div>
                    <input type="hidden" id="recurring-payment-type" value="standard">

                    <!-- Income/Expense Toggle (standard only) -->
                    <div class="radio-group" id="recurring-income-expense-toggle">
                        <input type="radio" id="type-expense-recurring" name="transaction-type-recurring" value="expense" checked>
                        <label for="type-expense-recurring">Expense</label>
                        <input type="radio" id="type-income-recurring" name="transaction-type-recurring" value="income">
                        <label for="type-income-recurring">Income</label>
                    </div>

                    <!-- Name -->
                    <input type="text" id="recurring-name" placeholder="Name (e.g., Netflix Subscription)" required>
                    
                    <!-- ===== SCHEDULING SECTION ===== -->
                    <div class="form-section">
                        <div class="form-section-label">
                            <span class="material-icons-outlined">schedule</span>
                            Scheduling
                        </div>
                        
                        <div class="form-row-2col">
                            <div class="form-field">
                                <label for="recurring-account-select" class="field-label-sm">Account</label>
                                <select id="recurring-account-select" class="settings-input" required></select>
                            </div>
                            <div class="form-field">
                                <label for="recurring-category-select" class="field-label-sm">Category</label>
                                <select id="recurring-category-select" class="settings-input"></select>
                            </div>
                        </div>

                        <div class="form-field">
                            <label for="recurring-frequency-select" class="field-label-sm">Frequency</label>
                            <select id="recurring-frequency-select" class="settings-input" required>
                                <option value="" disabled selected>Select frequency</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="yearly">Yearly</option>
                            </select>
                        </div>

                        <div class="form-row-2col">
                            <div class="form-field">
                                <label for="recurring-start-date" class="field-label-sm">Start Date</label>
                                <input type="date" id="recurring-start-date" required>
                            </div>
                            <div class="form-field">
                                <label for="recurring-end-date" class="field-label-sm">End Date (optional)</label>
                                <input type="date" id="recurring-end-date">
                            </div>
                        </div>
                    </div>

                    <!-- ===== DEBT DETAILS SECTION (debt only) ===== -->
                    <div id="debt-details-section" class="form-section debt-section" style="display: none;">
                        <div class="form-section-label">
                            <span class="material-icons-outlined">account_balance</span>
                            Debt Details
                        </div>

                        <div id="debt-total-amount-group" class="form-field">
                            <label for="recurring-total-amount" class="field-label-sm">Total Debt Amount</label>
                            <input type="number" id="recurring-total-amount" placeholder="e.g., 50000" step="0.01" min="0">
                        </div>

                        <div id="debt-paid-amount-group" class="form-field">
                            <label for="recurring-paid-amount" class="field-label-sm">Already Paid</label>
                            <input type="number" id="recurring-paid-amount" placeholder="0" step="0.01" min="0" value="0">
                        </div>
                    </div>

                    <!-- ===== PAYMENT CALCULATION SECTION (debt only) ===== -->
                    <div id="debt-calc-section" class="form-section debt-section" style="display: none;">
                        <div class="form-section-label">
                            <span class="material-icons-outlined">calculate</span>
                            Payment Calculation
                        </div>

                        <div id="debt-method-group" class="debt-method-group">
                            <div class="debt-method-radios">
                                <label class="debt-method-option">
                                    <input type="radio" name="debt-method" value="by-amount" checked>
                                    <span>Set Amount</span>
                                </label>
                                <label class="debt-method-option">
                                    <input type="radio" name="debt-method" value="by-date">
                                    <span>Set End Date</span>
                                </label>
                            </div>
                        </div>

                        <div id="debt-payment-amount-group" class="form-field">
                            <label for="recurring-amount" class="field-label-sm">
                                <span id="debt-amount-label">Payment Amount Per Period</span>
                            </label>
                        </div>
                    </div>

                    <!-- Amount (always present) -->
                    <input type="number" id="recurring-amount" placeholder="Amount" step="0.01" min="0" required>
                    
                    <!-- ===== DEBT CALCULATOR RESULT ===== -->
                    <div id="debt-calculator-info" class="debt-calculator-info" style="display: none;">
                        <div class="debt-calc-row">
                            <span class="material-icons-outlined">schedule</span>
                            <span id="debt-calc-duration">Enter total debt to see estimated duration</span>
                        </div>
                        <div class="debt-calc-row">
                            <span class="material-icons-outlined">event</span>
                            <span id="debt-calc-end-date">Estimated payoff date will appear here</span>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="form-actions">
                         <button id="save-recurring-btn" class="button-primary">Add Recurring Transaction</button>
                         <button id="cancel-recurring-edit-btn" class="button-secondary" style="display: none;">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="settings-modal" class="modal">
    <div class="modal-content">
        <span class="modal-close-btn">&times;</span>
        <h2>Settings</h2>
        <div class="modal-form">
            <div class="setting-row">
                <label for="dashboard-title-input">Dashboard Title</label>
                <input type="text" id="dashboard-title-input" class="settings-input">
            </div>

            <div class="setting-row">
                <label for="currency-selector-input">Currency</label>
                <div id="currency-selector" class="currency-selector">
                    <input type="text" id="currency-selector-input" class="settings-input" autocomplete="off">
                    <div id="currency-dropdown" class="currency-dropdown">
                    </div>
                </div>
            </div>
            
            <div class="setting-row">
                <label for="gemini-api-key-input">Gemini API Key (for AI Categorization)</label>
                <input type="password" id="gemini-api-key-input" class="settings-input" placeholder="Enter API Key">
            </div>
            <div class="setting-row">
                <label for="density-setting">Layout Density</label>
                <div class="radio-group" id="density-setting">
                    <input type="radio" id="density-compact" name="density" value="compact">
                    <label for="density-compact">Compact</label>
                    <input type="radio" id="density-default" name="density" value="default" checked>
                    <label for="density-default">Default</label>
                    <input type="radio" id="density-comfortable" name="density" value="comfortable">
                    <label for="density-comfortable">Comfortable</label>
                </div>
            </div>
            <div class="setting-row">
                <label for="color-scheme-setting">Color Scheme</label>
                <div class="radio-group" id="color-scheme-setting">
                    <input type="radio" id="color-default" name="color-scheme" value="default" checked>
                    <label for="color-default">Default</label>
                    <input type="radio" id="color-mint" name="color-scheme" value="mint">
                    <label for="color-mint">Mint</label>
                    <input type="radio" id="color-crimson" name="color-scheme" value="crimson">
                    <label for="color-crimson">Crimson</label>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="import-modal" class="modal">
    <div class="modal-content">
        <span class="modal-close-btn">&times;</span>
        <h2>Import Transactions</h2>
        <div class="modal-form">
            <p style="font-size: 0.9em; opacity: 0.8; margin-bottom: 1em;">Upload a bank statement in Excel (.xlsx) or HTML (.html) format.</p>
            
            <div style="margin-bottom: 1em;">
                <label for="import-account-select" style="display:block; margin-bottom: 0.5em;">Select Account</label>
                <select id="import-account-select" class="settings-input" style="width: 100%;" required></select>
            </div>
            
            <div style="margin-bottom: 1em;">
                <label for="import-file-input" style="display:block; margin-bottom: 0.5em;">Select File</label>
                <input type="file" id="import-file-input" accept=".xlsx, .html, .htm" class="settings-input" style="padding: 0.5em; width: 100%;">
            </div>

            <div style="margin-bottom: 1em; display: flex; align-items: center; gap: 0.5em;">
                <input type="checkbox" id="use-ai-categorization" checked>
                <label for="use-ai-categorization">Smart AI Categorization (Gemini)</label>
            </div>

            <div id="import-status" style="margin-bottom: 1em; min-height: 1.2em; font-size: 0.9em;"></div>

            <button id="import-submit-btn" class="button-primary" style="width: 100%;">Import Data</button>
        </div>
    </div>
</div>